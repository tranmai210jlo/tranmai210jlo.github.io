<!doctype html><html lang="vi"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Tin tức & Kinh nghiệm MXD</title>
<style>
:root{color-scheme:dark}body{margin:0;background:#0d0f12;color:#e5e7eb;font-family:system-ui,Segoe UI,Roboto}
.wrap{max-width:1100px;margin:0 auto;padding:20px}h1{font-size:clamp(22px,3vw,40px);margin:.2rem 0 1rem}
.controls{display:flex;gap:12px;flex-wrap:wrap;margin:8px 0 16px}
.controls input,.controls select{padding:.55rem .75rem;border:1px solid #2a2d33;background:#111;color:#e5e7eb;border-radius:10px}
#list.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
.post-card{border:1px solid #2223;border-radius:12px;overflow:hidden;background:#111;box-shadow:0 2px 6px #0006}
.post-card img{width:100%;height:160px;object-fit:cover;display:block}
.post-card h3{margin:8px 0 4px;font-size:1.05rem}.post-card p{opacity:.9;margin:.25rem 0}
.meta{opacity:.8;font-size:.9rem;margin-bottom:6px}.tags{display:flex;gap:.25rem;flex-wrap:wrap}
.tag{background:#222;border:1px solid #333;padding:.15rem .4rem;border-radius:999px;font-size:.8rem}
.btn{display:inline-block;margin:16px auto 0;padding:.6rem 1rem;border:1px solid #3b3f46;border-radius:12px;background:#15181c;color:#e5e7eb}
.muted{opacity:.7;font-size:.9rem;margin:4px 0 10px}a{text-decoration:none;color:inherit}
</style></head><body>
<main class="wrap">
  <h1>Tin tức & Kinh nghiệm</h1>
  <div class="controls">
    <input id="q" type="search" placeholder="Tìm bài viết, từ khóa…"/>
    <select id="cat" aria-label="Lọc theo danh mục"><option value="">Tất cả danh mục</option></select>
  </div>
  <div id="list" class="grid"></div>
  <div style="text-align:center"><button id="more" class="btn">Xem thêm</button></div>
</main>

<script>
// MXD — nạp /tin-tuc/posts.json + lọc
(async function(){
  const $list=document.getElementById('list'),$q=document.getElementById('q'),$cat=document.getElementById('cat'),$more=document.getElementById('more');
  const catNorm=v=>{const raw=(v||'').trim().toLowerCase();return(!raw||raw.includes('tất cả'))?'':v;};

  let posts=[];
  try{
    const res=await fetch('/tin-tuc/posts.json',{cache:'no-store'});
    if(!res.ok)throw new Error('HTTP '+res.status);
    posts=await res.json();
  }catch(e){
    console.error('posts.json error',e);
    $list.innerHTML='<p class="muted">Không đọc được <code>tin-tuc/posts.json</code>.</p>'; $more.style.display='none'; return;
  }
  if(!Array.isArray(posts)||!posts.length){$list.innerHTML='<p class="muted">Chưa có bài trong <code>posts.json</code>.</p>'; $more.style.display='none'; return;}

  // build danh mục
  const cats=[...new Set(posts.map(p=>p.category).filter(Boolean))].sort();
  for(const c of cats){const o=document.createElement('option');o.value=c;o.textContent=c;$cat.appendChild(o);} $cat.value='';

  // phân trang + render
  let page=1; const PAGE_SIZE=9;
  const card=p=>{const d=new Date(p.date).toLocaleDateString('vi-VN');const tags=(p.tags||[]).map(t=>`<span class="tag">#${t}</span>`).join(' ');
    return `<article class="post-card">
      <a href="/tin-tuc/post.html?id=${encodeURIComponent(p.id)}">
        <img src="${p.cover||''}" alt="${p.title}" loading="lazy"/>
        <div style="padding:12px"><h3>${p.title}</h3><p>${p.excerpt||''}</p>
        <div class="meta">${d} · ${p.readingMins||5} phút đọc</div><div class="tags">${tags}</div></div>
      </a></article>`};
  const filtered=()=>{const q=($q.value||'').toLowerCase().trim(),c=catNorm($cat.value||'');
    return posts.filter(p=>{const hitCat=!c||p.category===c;const hay=[p.title,p.excerpt,...(p.tags||[])].join(' ').toLowerCase();return hitCat&&(!q||hay.includes(q));});};
  function render(reset=false){const data=filtered(); if(reset)page=1; const slice=data.slice(0,page*PAGE_SIZE);
    $list.innerHTML= slice.length? slice.map(card).join('') : '<p>Không có bài phù hợp.</p>';
    $more.style.display= slice.length<data.length ? '' : 'none';
  }
  $q.addEventListener('input',()=>render(true)); $cat.addEventListener('change',()=>render(true)); $more.addEventListener('click',()=>{page++;render(false);});
  render(true);
})();
</script>
</body></html>
